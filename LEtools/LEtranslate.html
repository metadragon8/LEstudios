<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEtranslate - Professional Translation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root{--lemon-yellow:#F7DC6F;--london-charcoal:#2C3A47;--foggy-white:#f4f4f7;--card-white:#ffffff;--text-color:#34495e;--brand-font:'Playfair Display',serif;--body-font:'Lato',sans-serif;}
        *{box-sizing:border-box;margin:0;padding:0;}
        body{font-family:var(--body-font);background-color:var(--foggy-white);color:var(--text-color);display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:20px;}
        .container{width:100%;max-width:700px;text-align:center;}
        header{width:100%;max-width:700px;text-align:center;padding:10px 0;display:flex;justify-content:space-between;align-items:center;}
        header h1{font-family:var(--brand-font);font-size:2.5em;color:var(--london-charcoal);flex-grow:1;text-align:center;margin:0;}
        footer{width:100%;text-align:center;padding:20px 0;font-size:0.9em;color:#aaa;margin-top:auto;}
        textarea{width:100%;min-height:180px;padding:15px;font-size:1.1em;font-family:var(--body-font);border:2px solid #ddd;border-radius:8px;resize:vertical;transition:border-color .3s,box-shadow .3s;}
        textarea:focus{outline:none;border-color:var(--lemon-yellow);box-shadow:0 0 10px rgba(247,220,111,0.5);}
        .controls{display:flex;justify-content:space-between;align-items:center;margin:20px 0;flex-wrap:wrap;gap:15px;}
        #languageSwitcher{display:flex;align-items:center;gap:10px;cursor:pointer;padding:8px;border-radius:50px;background-color:var(--card-white);box-shadow:0 2px 5px rgba(0,0,0,0.05);transition:box-shadow .3s;}
        #languageSwitcher:hover{box-shadow:0 4px 10px rgba(0,0,0,0.1);}
        .lang-label{font-weight:700;font-size:1.1em;padding:10px 20px;color:var(--london-charcoal);transition:all .3s ease;}
        .swap-icon-container{color:var(--london-charcoal);transition:transform .3s ease-in-out;}
        #languageSwitcher:hover .swap-icon-container{transform:rotate(180deg);}
        #translateBtn{background:linear-gradient(135deg,var(--london-charcoal),#536474);color:#fff;border:none;padding:15px 30px;font-size:1.1em;font-weight:700;border-radius:8px;cursor:pointer;transition:transform .2s,box-shadow .3s;box-shadow:0 4px 15px rgba(0,0,0,0.1);}
        #translateBtn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,0.15);}
        #translateBtn:disabled{background:#aaa;cursor:not-allowed;transform:translateY(0);}
        #results{margin-top:30px;text-align:left;}
        .result-card{position:relative;background-color:var(--card-white);border:1px solid #e9ecef;border-left:5px solid var(--lemon-yellow);border-radius:8px;padding:20px;padding-top:45px;margin-bottom:20px;box-shadow:0 5px 15px rgba(0,0,0,0.07);}
        .result-card h3{font-family:var(--brand-font);margin:0 0 12px;color:var(--london-charcoal);font-size:1.5em;}
        .result-card p{font-size:1.1em;line-height:1.7;white-space:pre-wrap;}
        .analysis-section{border-top:1px dashed #ddd;margin-top:20px;padding-top:20px;font-size:0.95em;color:#555;}
        .analysis-section strong{color:var(--london-charcoal);}
        
       
        .analysis-section p, .analysis-section div { margin-bottom: 0.8em; }
        .analysis-section ul { list-style: none; padding-left: 20px; margin-top: 5px; }
        .analysis-section li { margin-bottom: 0.5em; }
        
        
        .rtl-text{direction:rtl;text-align:right;}
        .copy-btn{position:absolute;top:15px;right:15px;background:0 0;border:none;color:#aaa;cursor:pointer;font-size:1.2em;transition:color .2s;}
        .copy-btn:hover{color:var(--london-charcoal);}
        .word-clickable{cursor:pointer;transition:background-color .2s;border-radius:3px;}
        .word-clickable:hover{background-color:var(--lemon-yellow);}
        #wordModal{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;opacity:0;visibility:hidden;transition:opacity .3s,visibility .3s;z-index:1001;}
        #wordModal.visible{opacity:1;visibility:visible;}
        .modal-content{background:var(--card-white);padding:30px;border-radius:10px;width:90%;max-width:500px;box-shadow:0 10px 30px rgba(0,0,0,0.2);position:relative; text-align: left;}
        .modal-close{position:absolute;top:15px;right:15px;background:0 0;border:none;font-size:1.5em;cursor:pointer;}
        #modal-word{font-family:var(--brand-font);font-size:2em;margin-bottom:15px;}
        #modal-body p{margin-bottom:10px;}
        #modal-body strong{color:var(--london-charcoal);}
        .header-btn{font-size:1.5em;background:0 0;border:none;color:var(--london-charcoal);cursor:pointer;width:50px;}
        #history-panel{position:fixed;top:0;right:-100%;width:100%;max-width:320px;height:100%;background:var(--card-white);box-shadow:-5px 0 15px rgba(0,0,0,0.1);transition:right .3s ease;z-index:1000;padding:20px;overflow-y:auto;}
        #history-panel.visible{right:0;}
        #history-panel h2{font-family:var(--brand-font);margin-bottom:20px;}
        .history-item{padding:10px;border-bottom:1px solid #eee;cursor:pointer;font-size:.9em; text-align:left; color:#333; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;}
        .history-item:hover{background-color:var(--foggy-white);}
        @media (max-width:768px){body{padding:10px;}header h1{font-size:2em;} .header-btn {width:40px;} .controls{flex-direction:column;gap:20px;}#languageSwitcher{width:100%;justify-content:center;}.lang-label{padding:8px 15px;font-size:1em;}#translateBtn{width:100%;}.result-card h3{font-size:1.3em;}.result-card p{font-size:1em;}}
    </style>
</head>
<body>
    <header>
        <button id="historyBtn" class="header-btn" aria-label="History"><i class="fas fa-history"></i></button>
        <h1>LEtranslate</h1>
        <div class="header-btn"></div>
    </header>
    <main class="container">
        <textarea id="inputText" placeholder="Enter your text here..."></textarea>
        <div class="controls">
            <div id="languageSwitcher">
                <span id="lang1" class="lang-label">English</span>
                <div class="swap-icon-container"><i class="fas fa-exchange-alt"></i></div>
                <span id="lang2" class="lang-label">Persian</span>
            </div>
            <button id="translateBtn">Translate & Analyze</button>
        </div>
        <div id="results"></div>
    </main>
    <div id="history-panel">
        <button class="modal-close" id="historyCloseBtn" aria-label="Close history">&times;</button>
        <h2>History</h2>
        <div id="history-list">Your history will appear here.</div>
    </div>
    <div id="wordModal">
        <div class="modal-content">
            <button class="modal-close" id="modalCloseBtn" aria-label="Close word analysis">&times;</button>
            <h2 id="modal-word"></h2>
            <div id="modal-body"></div>
        </div>
    </div>
    <footer><p>© 2025 LEtranslate. All rights reserved.</p></footer>

    <script>
        
        
        const translateBtn = document.getElementById('translateBtn');
        const inputText = document.getElementById('inputText');
        const resultsDiv = document.getElementById('results');
        const languageSwitcher = document.getElementById('languageSwitcher');
        const lang1El = document.getElementById('lang1');
        const lang2El = document.getElementById('lang2');
        const historyBtn = document.getElementById('historyBtn');
        const historyPanel = document.getElementById('history-panel');
        const historyCloseBtn = document.querySelector('#history-panel .modal-close');
        const historyList = document.getElementById('history-list');
        const wordModal = document.getElementById('wordModal');
        const modalCloseBtn = document.getElementById('modalCloseBtn');
        const modalWordEl = document.getElementById('modal-word');
        const modalBodyEl = document.getElementById('modal-body');
        
        const WORKER_URL = "https://patient-bread-52dd.lemonzm7.workers.dev/"; 
        let fromLanguage = 'en';
        let history = [];

        document.addEventListener('DOMContentLoaded', loadHistory);
        translateBtn.addEventListener('click', handleTranslateClick);
        languageSwitcher.addEventListener('click', handleLanguageSwitch);
        resultsDiv.addEventListener('click', handleResultClick);
        historyBtn.addEventListener('click', () => toggleHistoryPanel(true));
        historyCloseBtn.addEventListener('click', () => toggleHistoryPanel(false));
        wordModal.addEventListener('click', (e) => e.target === wordModal && toggleWordModal(false));
        modalCloseBtn.addEventListener('click', () => toggleWordModal(false));
        historyList.addEventListener('click', handleHistoryClick);

        async function handleTranslateClick() 
        function handleLanguageSwitch() 
        function handleResultClick(event) 
        async function handleWordAnalysis(word, lang) 
        function handleHistoryClick(event) 

        

        function displayResults(data, originalText) {
            resultsDiv.innerHTML = '';
            let translationCounter = 1;
            const wrapWords = (text) => String(text).split(/(\s+|[,.-?!--:;])/).map(part => part.trim() && !/[,.-?!--:;]|\s+/.test(part) ? `<span class="word-clickable">${part}</span>` : part).join('');
            
            resultsDiv.appendChild(createResultCard('Original Text', `<p class="${isRTL(originalText) ? 'rtl-text' : ''}">${wrapWords(originalText)}</p>`));
            
            const aiResult = data.find(item => item.source.startsWith('AI Analysis'));
            if (aiResult) {
                const analysisContent = formatAnalysisToHTML(aiResult.analysis);
                const translationContent = aiResult.translation;

                resultsDiv.appendChild(createResultCard(`Translation & AI Analysis`, `
                    <p class="${isRTL(translationContent) ? 'rtl-text' : ''}">${wrapWords(translationContent)}</p>
                    <div class="analysis-section">
                        <strong>AI Analysis:</strong>
                        <div class="${isRTL(analysisContent) ? 'rtl-text' : ''}">${analysisContent}</div>
                    </div>`
                ));
            }
            
            data.filter(t => t.translation && !t.source.startsWith('AI Analysis')).forEach(t => {
                resultsDiv.appendChild(createResultCard(`Translation #${translationCounter}`, `<p class="${isRTL(t.translation) ? 'rtl-text' : ''}">${wrapWords(t.translation)}</p>`));
                translationCounter++;
            });
        }
        
        function formatAnalysisToHTML(analysis) {
            if (typeof analysis === 'string') return `<p>${analysis}</p>`;
            if (typeof analysis !== 'object' || analysis === null) return '<p>Analysis not available.</p>';

            let htmlOutput = '';
            for (const [key, value] of Object.entries(analysis)) {
                const formattedKey = key.replace(/_/g, ' ').replace(/\b\w/g, char => char.toUpperCase());
                
                htmlOutput += `<p><strong>${formattedKey}:</strong> `;

                if (typeof value === 'string') {
                    htmlOutput += value;
                } else if (Array.isArray(value)) {
                    htmlOutput += `<ul>${value.map(item => `<li>${item}</li>`).join('')}</ul>`;
                } else if (typeof value === 'object' && value !== null) {
                    htmlOutput += `</p><ul>${Object.entries(value).map(([subKey, subValue]) => `<li><em>${subKey.replace(/_/g, ' ')}:</em> ${subValue}</li>`).join('')}</ul>`;
                    
                    continue; 
                } else {
                    htmlOutput += String(value);
                }
                htmlOutput += `</p>`;
            }
            return htmlOutput;
        }

      

        function createResultCard(title, content)
        function toggleWordModal(show) 
        function toggleHistoryPanel(show) 
        function setLoading(isLoading) 
        function loadHistory() 
        function saveToHistory(text) 
        function displayHistory() 
        function isRTL(str) { return /[\u0600-\u06FF]/.test(String(str)); }

        
        const fullScriptContent = {
            init() {
                this.setupVariables();
                this.setupListeners();
                this.loadHistory();
            },
            setupVariables() {
               
            },
            setupListeners() {
               
            }
            
        };
        
        
        document.getElementById('full-script-block')?.remove();
        
       
        (function() {
            const translateBtn = document.getElementById('translateBtn');
            const inputText = document.getElementById('inputText');
            const resultsDiv = document.getElementById('results');
            const languageSwitcher = document.getElementById('languageSwitcher');
            const lang1El = document.getElementById('lang1');
            const lang2El = document.getElementById('lang2');
            const historyBtn = document.getElementById('historyBtn');
            const historyPanel = document.getElementById('history-panel');
            const historyCloseBtn = document.querySelector('#history-panel .modal-close');
            const historyList = document.getElementById('history-list');
            const wordModal = document.getElementById('wordModal');
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            const modalWordEl = document.getElementById('modal-word');
            const modalBodyEl = document.getElementById('modal-body');
            
            const WORKER_URL = "https://patient-bread-52dd.lemonzm7.workers.dev/"; 
            let fromLanguage = 'en';
            let history = [];

            document.addEventListener('DOMContentLoaded', loadHistory);
            translateBtn.addEventListener('click', handleTranslateClick);
            languageSwitcher.addEventListener('click', handleLanguageSwitch);
            resultsDiv.addEventListener('click', handleResultClick);
            historyBtn.addEventListener('click', () => toggleHistoryPanel(true));
            historyCloseBtn.addEventListener('click', () => toggleHistoryPanel(false));
            wordModal.addEventListener('click', (e) => e.target === wordModal && toggleWordModal(false));
            modalCloseBtn.addEventListener('click', () => toggleWordModal(false));
            historyList.addEventListener('click', handleHistoryClick);

            async function handleTranslateClick() {
                const text = inputText.value.trim();
                if (!text) { alert('Please enter some text to analyze.'); return; }
                setLoading(true);
                try {
                    const response = await fetch(WORKER_URL, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text, from: fromLanguage })
                    });
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.error || 'Server error');
                    displayResults(data, text);
                    saveToHistory(text);
                } catch (error) {
                    resultsDiv.innerHTML = `<div class="result-card error-card"><h3>Error</h3><p>${error.message}</p></div>`;
                } finally { setLoading(false); }
            }
            
            function handleLanguageSwitch() {
                fromLanguage = fromLanguage === 'en' ? 'fa' : 'en';
                const temp = lang1El.textContent;
                lang1El.textContent = lang2El.textContent;
                lang2El.textContent = temp;
                inputText.placeholder = fromLanguage === 'en' ? 'Enter your text here...' : 'متن خود را اینجا وارد کنید...';
            }
            
            function handleResultClick(event) {
                const target = event.target;
                const copyIcon = target.closest('.copy-btn');
                if (copyIcon) {
                    const textToCopy = copyIcon.closest('.result-card').querySelector('p').innerText;
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        const icon = copyIcon.querySelector('i');
                        icon.classList.remove('fa-copy'); icon.classList.add('fa-check');
                        setTimeout(() => { icon.classList.remove('fa-check'); icon.classList.add('fa-copy'); }, 2000);
                    });
                }
                if (target.classList.contains('word-clickable')) {
                    const word = target.innerText.replace(/[^a-zA-Zآ-ی\s-]/g, '').trim();
                    const wordLang = isRTL(word) ? 'fa' : 'en';
                    if (word) handleWordAnalysis(word, wordLang);
                }
            }

            async function handleWordAnalysis(word, lang) {
                toggleWordModal(true);
                modalWordEl.textContent = word;
                modalBodyEl.innerHTML = '<p>Analyzing...</p>';
                try {
                     const response = await fetch(WORKER_URL, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ word, lang })
                    });
                    if (!response.ok) throw new Error('Could not fetch analysis from server.');
                    const data = await response.json();
                    const analysisClass = isRTL(data.definition) ? 'rtl-text' : '';
                    modalBodyEl.innerHTML = `<div class="${analysisClass}"><p><strong>Definition:</strong> ${data.definition}</p><p><strong>Synonyms:</strong> ${Array.isArray(data.synonyms) ? data.synonyms.join(', ') : data.synonyms}</p><p><strong>Example:</strong> "${data.example}"</p></div>`;
                } catch(e) { modalBodyEl.innerHTML = `<p>${e.message}</p>`; }
            }
            
            function handleHistoryClick(event) {
                const item = event.target.closest('.history-item');
                if (item) {
                    const text = item.dataset.text;
                    inputText.value = text;
                    toggleHistoryPanel(false);
                    handleTranslateClick();
                }
            }
            
            function displayResults(data, originalText) {
                resultsDiv.innerHTML = '';
                let translationCounter = 1;
                const wrapWords = (text) => String(text).split(/(\s+|[,.-?!--:;])/).map(part => part.trim() && !/[,.-?!--:;]|\s+/.test(part) ? `<span class="word-clickable">${part}</span>` : part).join('');
                resultsDiv.appendChild(createResultCard('Original Text', `<p class="${isRTL(originalText) ? 'rtl-text' : ''}">${wrapWords(originalText)}</p>`));
                const aiResult = data.find(item => item.source.startsWith('AI Analysis'));
                if (aiResult) {
                    const analysisContent = formatAnalysisToHTML(aiResult.analysis);
                    resultsDiv.appendChild(createResultCard(`Translation & AI Analysis`, `<p class="${isRTL(aiResult.translation) ? 'rtl-text' : ''}">${wrapWords(aiResult.translation)}</p><div class="analysis-section"><strong>AI Analysis:</strong><div class="${isRTL(analysisContent) ? 'rtl-text' : ''}">${analysisContent}</div></div>`));
                }
                data.filter(t => t.translation && !t.source.startsWith('AI Analysis')).forEach(t => {
                    resultsDiv.appendChild(createResultCard(`Translation #${translationCounter}`, `<p class="${isRTL(t.translation) ? 'rtl-text' : ''}">${wrapWords(t.translation)}</p>`));
                    translationCounter++;
                });
            }

            function formatAnalysisToHTML(analysis) {
                if (typeof analysis === 'string') return `<p>${analysis}</p>`;
                if (typeof analysis !== 'object' || analysis === null) return '<p>Analysis not available.</p>';
                let htmlOutput = '';
                for (const [key, value] of Object.entries(analysis)) {
                    const formattedKey = key.replace(/_/g, ' ').replace(/\b\w/g, char => char.toUpperCase());
                    htmlOutput += `<p><strong>${formattedKey}:</strong> `;
                    if (typeof value === 'string') {
                        htmlOutput += value;
                    } else if (Array.isArray(value)) {
                        htmlOutput += `</p><ul>${value.map(item => `<li>${item}</li>`).join('')}</ul>`;
                        continue;
                    } else if (typeof value === 'object' && value !== null) {
                        htmlOutput += `</p><ul>${Object.entries(value).map(([subKey, subValue]) => `<li><em>${subKey.replace(/_/g, ' ')}:</em> ${subValue}</li>`).join('')}</ul>`;
                        continue;
                    } else {
                        htmlOutput += String(value);
                    }
                    htmlOutput += `</p>`;
                }
                return htmlOutput;
            }
            
            function createResultCard(title, content) {
                const card = document.createElement('div');
                card.className = 'result-card';
                card.innerHTML = `<button class="copy-btn" aria-label="Copy text"><i class="fas fa-copy"></i></button><h3>${title}</h3>${content}`;
                return card;
            }
            function toggleWordModal(show) { wordModal.classList.toggle('visible', show); }
            function toggleHistoryPanel(show) { historyPanel.classList.toggle('visible', show); }
            function setLoading(isLoading) {
                translateBtn.disabled = isLoading;
                translateBtn.textContent = isLoading ? 'Processing...' : 'Translate & Analyze';
            }
            function loadHistory() {
                history = JSON.parse(localStorage.getItem('letranslateHistory')) || [];
                displayHistory();
            }
            function saveToHistory(text) {
                if (!history.some(h => h.text === text)) {
                    history.unshift({ text });
                }
                history = history.slice(0, 15);
                localStorage.setItem('letranslateHistory', JSON.stringify(history));
                displayHistory();
            }
            function displayHistory() {
                historyList.innerHTML = history.length 
                    ? history.map(item => `<div class="history-item" data-text="${item.text}">${item.text.substring(0, 30)}...</div>`).join('') 
                    : '<p>No history yet.</p>';
            }
            function isRTL(str) { return /[\u0600-\u06FF]/.test(String(str)); }
        })();
    </script>
</body>

</html>
